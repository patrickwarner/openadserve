!function(e){const t="ad_user_id";let n=e.AD_SERVER_API_KEY||null,o=e.AD_SERVER_PUBLISHER_ID||null,r={},a={};function s(t){return t||e.AD_SERVER_URL||"http://localhost:8787"}async function i(i,d,c,l,p,u){const m=function(){let e=localStorage.getItem(t);return e||(e="user_"+Math.random().toString(36).slice(2,12),localStorage.setItem(t,e)),e}(),f="req_"+Math.random().toString(36).slice(2,10),h=l||o||e.AD_SERVER_PUBLISHER_ID,y={id:f,imp:[{id:"1",tagid:i}],user:{id:m},device:{ua:navigator.userAgent},ext:{publisher_id:h}};c&&Object.keys(c).length>0&&(y.ext.kv=c);const g=function(e,t={}){let n={...r};return a[e]&&(n={...n,...a[e]}),n={...n,...t},n}(i,u);Object.keys(g).length>0&&(y.ext.custom_params=g);const b=`${s(d)}/ad${"localhost"===e.location.hostname||"127.0.0.1"===e.location.hostname||e.location.hostname.includes("dev")||"file:"===e.location.protocol?"?debug=1":""}`,v={"Content-Type":"application/json"},x=p||n||e.AD_SERVER_API_KEY;x&&(v["X-API-Key"]=x);const E=await fetch(b,{method:"POST",headers:v,body:JSON.stringify(y)});if(!E.ok)throw new Error(`AdSDK: Ad server request to ${b} failed with HTTP status ${E.status}`);return await E.json()}function d(e,t){(new Image).src=s(t)+e}function c(e,t){e&&d(e,t)}function l(e,t,n){t&&n&&d(`${t}&type=${encodeURIComponent(n)}`,e)}function p(e,t,n){if(!e||!t)return Promise.reject("missing report url or reason");const o=e.split("t=")[1];return fetch(s(n)+"/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:o,reason:t})})}function u(e){e&&"object"==typeof e&&(r={...r,...e})}const m=[{code:"offensive",display:"Offensive or inappropriate",description:"Contains offensive or inappropriate content"},{code:"malware",display:"Malware or security risk",description:"Links to malware or attempts phishing"},{code:"misleading",display:"Misleading or scam",description:"Deceptive or fraudulent ad"},{code:"irrelevant",display:"Irrelevant",description:"Not relevant to the page content"},{code:"other",display:"Other",description:"Other issue"}];function f(e,t){const n=document.getElementById("adsdk-report-modal");n&&n.remove();const o=document.createElement("div");o.id="adsdk-report-modal",o.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.5);\n      z-index: 10000;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: Arial, sans-serif;\n    ";const r=document.createElement("div");r.style.cssText="\n      background: white;\n      padding: 20px;\n      border-radius: 8px;\n      max-width: 400px;\n      width: 90%;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n    ";const a=document.createElement("div");a.style.cssText="\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 15px;\n    ";const s=document.createElement("h3");s.textContent="Report Ad",s.style.cssText="\n      margin: 0;\n      color: #333;\n      font-size: 18px;\n    ";const i=document.createElement("button");i.textContent="×",i.style.cssText="\n      background: none;\n      border: none;\n      font-size: 24px;\n      cursor: pointer;\n      color: #666;\n      padding: 0;\n      width: 30px;\n      height: 30px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    ",i.addEventListener("click",()=>o.remove()),a.appendChild(s),a.appendChild(i);const d=document.createElement("label");d.textContent="Why are you reporting this ad?",d.style.cssText="\n      display: block;\n      margin-bottom: 8px;\n      font-weight: bold;\n      color: #333;\n    ";const c=document.createElement("select");c.style.cssText="\n      width: 100%;\n      padding: 8px;\n      margin-bottom: 15px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      font-size: 14px;\n    ";const l=document.createElement("option");l.value="",l.textContent="Select a reason...",c.appendChild(l),m.forEach(e=>{const t=document.createElement("option");t.value=e.code,t.textContent=e.display,t.title=e.description,c.appendChild(t)});const u=document.createElement("div");u.style.cssText="\n      display: flex;\n      gap: 10px;\n      justify-content: flex-end;\n    ";const f=document.createElement("button");f.textContent="Cancel",f.style.cssText="\n      padding: 8px 16px;\n      border: 1px solid #ddd;\n      background: white;\n      color: #333;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 14px;\n    ",f.addEventListener("click",()=>o.remove());const h=document.createElement("button");h.textContent="Report",h.style.cssText="\n      padding: 8px 16px;\n      border: none;\n      background: #dc3545;\n      color: white;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 14px;\n    ",h.addEventListener("click",()=>{const n=c.value;n?(h.disabled=!0,h.textContent="Reporting...",p(e,n,t).then(()=>{o.remove();const e=document.createElement("div");e.textContent="Ad reported successfully. Thank you for your feedback.",e.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: #28a745;\n            color: white;\n            padding: 10px 15px;\n            border-radius: 4px;\n            z-index: 10001;\n            font-family: Arial, sans-serif;\n            font-size: 14px;\n          ",document.body.appendChild(e),setTimeout(()=>e.remove(),3e3)}).catch(e=>{console.warn("AdSDK: report failed",e),h.disabled=!1,h.textContent="Report",alert("Failed to report ad. Please try again.")})):alert("Please select a reason for reporting this ad.")}),u.appendChild(f),u.appendChild(h),r.appendChild(a),r.appendChild(d),r.appendChild(c),r.appendChild(u),o.appendChild(r),o.addEventListener("click",e=>{e.target===o&&o.remove()});const y=e=>{"Escape"===e.key&&(o.remove(),document.removeEventListener("keydown",y))};document.addEventListener("keydown",y),document.body.appendChild(o),c.focus()}e.AdSDK={renderAd:function(t,n,o,r,a,d,p){const u=document.getElementById(n);u?i(t,o,r,a,d,p).then(n=>{const r=n.seatbid||[];if(0===r.length||0===(r[0].bid||[]).length){console.info(`AdSDK: No ad available for placement '${t}'. Reason: ${n.nbr||"Unknown"}.`),u.innerHTML="";const e=new CustomEvent("AdSDK:noAd",{detail:{placementId:t,reason:n.nbr}});return void u.dispatchEvent(e)}const a=r[0].bid[0],{adm:i,impurl:d,clkurl:p,evturl:m,repturl:h}=a,y="adInst_"+Math.random().toString(36).slice(2,10);e.addEventListener("message",function(t){t.data&&t.data.adInstanceId===y&&("ad_sdk_click"===t.data.type?p&&e.open(s(o)+p,"_blank"):"ad_sdk_event"===t.data.type&&t.data.eventType&&(m?l(o,m,t.data.eventType):console.warn(`AdSDK: Event tracking URL not available for event '${t.data.eventType}'.`)))}),h&&(u.dataset.reportUrl=h);const g=document.createElement("div");g.style.position="relative",g.style.width="100%",g.style.height="100%";const b=document.createElement("iframe");b.style.border="0",b.style.width="100%",b.style.height="100%",b.setAttribute("sandbox","allow-scripts allow-popups");const v=document.createElement("button");v.innerHTML="⋯",v.style.position="absolute",v.style.top="4px",v.style.right="4px",v.style.zIndex="1000",v.style.background="rgba(0, 0, 0, 0.6)",v.style.color="white",v.style.border="none",v.style.borderRadius="50%",v.style.width="20px",v.style.height="20px",v.style.fontSize="12px",v.style.cursor="pointer",v.style.fontFamily="Arial, sans-serif",v.style.display="flex",v.style.alignItems="center",v.style.justifyContent="center",v.style.lineHeight="1",v.style.transition="background 0.2s ease",v.title="Report this ad",v.addEventListener("mouseenter",()=>{v.style.background="rgba(0, 0, 0, 0.8)"}),v.addEventListener("mouseleave",()=>{v.style.background="rgba(0, 0, 0, 0.6)"}),v.addEventListener("click",()=>{h&&f(h,o)}),g.appendChild(b),g.appendChild(v),u.innerHTML="",u.appendChild(g);const x=`<!DOCTYPE html>\n          <html lang="en">\n          <head><meta charset="UTF-F"><title>Ad</title><style>body{margin:0;padding:0;display:flex;align-items:center;justify-content:center;}</style></head>\n          <body>\n            ${i}\n            <script type="text/javascript">\n              // Function exposed inside the iframe for the creative to call for custom events.\n              window.AdSDK_Creative_Event = function(eventType) {\n                parent.postMessage({ type: 'ad_sdk_event', adInstanceId: '${y}', eventType: eventType }, '*');\n              };\n              // Global click listener within the iframe to report clicks.\n              document.body.addEventListener('click', function() {\n                parent.postMessage({ type: 'ad_sdk_click', adInstanceId: '${y}' }, '*');\n              });\n            <\/script>\n          </body></html>`;b.srcdoc=x,c(d,o)}).catch(e=>{console.warn(`AdSDK: Error fetching or rendering ad for placement '${t}':`,e);const n=new CustomEvent("AdSDK:error",{detail:{placementId:t,error:e.message}});u.dispatchEvent(n)}):console.warn("AdSDK: container not found:",n)},fetchAd:i,renderNativeAd:function(e,t,n,o,r,a,s,p){const u=document.getElementById(t);u?i(e,o,r,a,s,p).then(t=>{const r=t.seatbid?.[0]?.bid?.[0];if(!r){console.info(`AdSDK: No native ad available for placement '${e}'. Reason: ${t.nbr||"Unknown"}.`),u.innerHTML="";const n=new CustomEvent("AdSDK:noAd",{detail:{placementId:e,reason:t.nbr}});return void u.dispatchEvent(n)}let a;try{a="string"==typeof r.adm?JSON.parse(r.adm):r.adm}catch(t){console.error("AdSDK: Failed to parse native ad assets (bid.adm). Ensure it's valid JSON.",t);const n=new CustomEvent("AdSDK:error",{detail:{placementId:e,error:"Failed to parse native assets."}});return void u.dispatchEvent(n)}const{impurl:s,clkurl:i,evturl:p,repturl:m}=r,h={...a,clickUrl:i||null,impressionUrl:s||null,eventUrl:p||null},y="function"==typeof n?n(h):`\x3c!-- Default native rendering if no template provided --\x3e\n             <div>\n               <h2>${h.title||"Native Ad"}</h2>\n               ${h.image?`<img src="${h.image.url}" alt="${h.image.alt||h.title||""}" width="${h.image.w||""}" height="${h.image.h||""}"/>`:""}\n               <p>${h.description||""}</p>\n               ${h.clickUrl?`<a href="${h.clickUrl}" target="_blank">Learn More</a>`:""}\n             </div>`;if(u.innerHTML=y,c(s,o),m&&(u.dataset.reportUrl=m,!u.querySelector("[data-adsdk-report]")&&!u.hasAttribute("data-disable-reporting"))){const e=document.createElement("button");e.innerHTML="⋯",e.style.fontSize="12px",e.style.width="20px",e.style.height="20px",e.style.marginTop="5px",e.style.background="#f8f9fa",e.style.border="1px solid #dee2e6",e.style.borderRadius="50%",e.style.cursor="pointer",e.style.color="#6c757d",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.lineHeight="1",e.style.transition="background 0.2s ease",e.title="Report this ad",e.setAttribute("data-adsdk-report","true"),e.addEventListener("mouseenter",()=>{e.style.background="#e9ecef"}),e.addEventListener("mouseleave",()=>{e.style.background="#f8f9fa"}),e.addEventListener("click",()=>{f(m,o)}),u.appendChild(e)}u.addEventListener("click",e=>{const t=e.target.closest("[data-ad-event]");if(t&&p){const e=t.getAttribute("data-ad-event");if(e)return void l(o,p,e)}e.target.closest('a[href*="/click?"]')||function(e,t){e&&d(e,t)}(i,o)})}).catch(t=>{console.warn(`AdSDK: Error fetching or rendering native ad for placement '${e}':`,t);const n=new CustomEvent("AdSDK:error",{detail:{placementId:e,error:t.message}});u.dispatchEvent(n)}):console.warn("AdSDK: container not found:",t)},setApiKey:function(e){n=e},setPublisherId:function(e){o=e},setCustomParams:u,setUTMFromPage:function(){const t=function(){const t=new URLSearchParams(e.location.search),n={};if(["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(e=>{const o=t.get(e);o&&(n[e]=o)}),["gclid","fbclid","msclkid","twclid","li_fat_id"].forEach(e=>{const o=t.get(e);o&&(n[e]=o)}),document.referrer)try{const t=new URL(document.referrer);n.referrer_domain=t.hostname,t.hostname!==e.location.hostname&&(n.referrer_url=document.referrer)}catch(e){}return n}();Object.keys(t).length>0&&u(t)},setAdSlotCustomParams:function(e,t){e&&t&&"object"==typeof t&&(a[e]||(a[e]={}),a[e]={...a[e],...t})},getCustomParams:function(){return{...r}},getAdSlotCustomParams:function(e){return a[e]?{...a[e]}:{}},clearCustomParams:function(){r={}},clearAdSlotCustomParams:function(e){a[e]&&delete a[e]},reportAd:p,showReportModal:f,getReportLinkHTML:function(e="Report Ad",t="",n={}){const o={fontSize:"10px",padding:"2px 6px",background:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"3px",cursor:"pointer",color:"#6c757d",textDecoration:"none",display:"inline-block",...n};return`<button data-adsdk-report="true" class="${t}" style="${Object.entries(o).map(([e,t])=>`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${t}`).join("; ")}" onclick="AdSDK.showReportModal(this.closest('[data-report-url]').dataset.reportUrl || this.closest('.native-ad, .ad-placement').dataset.reportUrl)" title="Report this ad">⋯</button>`}}}(window);
//# sourceMappingURL=adsdk.min.js.map
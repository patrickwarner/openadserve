# =============================================================================
# Ad Server Configuration
# =============================================================================
# Copy this file to .env and modify as needed for your environment
# Values below are configured for Docker Compose deployment

# =============================================================================
# Core Server Settings
# =============================================================================
# Service identification (used for observability)
SERVICE_NAME=openadserve

# HTTP server configuration
PORT=8787
READ_TIMEOUT=5s
WRITE_TIMEOUT=10s

# Configuration reload settings
RELOAD_INTERVAL=30s

# =============================================================================
# Database & Storage Connections
# =============================================================================

# PostgreSQL (configuration data: campaigns, line items, etc.)
POSTGRES_DSN=postgres://postgres:postgres@postgres:5432/postgres?sslmode=disable

# ClickHouse (analytics events storage)
# Async inserts enabled for better performance with high-volume event ingestion
CLICKHOUSE_DSN=clickhouse://default:@clickhouse:9000/default?async_insert=1&wait_for_async_insert=0&async_insert_max_data_size=10000000&async_insert_busy_timeout_ms=500&async_insert_stale_timeout_ms=10000&async_insert_deduplicate=0

# Redis (frequency capping and pacing counters)
REDIS_ADDR=redis:6379

# Database connection pooling
DB_MAX_OPEN_CONNS=25
DB_MAX_IDLE_CONNS=5
DB_CONN_MAX_LIFETIME=5m

# =============================================================================
# Ad Selection & Targeting
# =============================================================================
# GeoIP database path for country/region targeting
GEOIP_DB=data/GeoLite2-Country.mmdb

# Line item priority configuration (comma-separated, highest to lowest)
PRIORITY_ORDER=high,medium,low

# =============================================================================
# CTR Optimization & Bidding
# =============================================================================
# CTR estimation for CPC line items
DEFAULT_CTR=0.5
CTR_WEIGHT=2

# CTR optimization service
CTR_OPTIMIZATION_ENABLED=true
CTR_PREDICTOR_URL=http://ctr-predictor:8000
CTR_PREDICTOR_TIMEOUT=200ms
CTR_PREDICTOR_CACHE_TTL=5m

# =============================================================================
# Traffic & Rate Management
# =============================================================================
# Rate limiting for direct line items (prevents request floods)
RATE_LIMIT_ENABLED=false
RATE_LIMIT_CAPACITY=1000
RATE_LIMIT_REFILL_RATE=500

# Programmatic demand timeouts
PROGRAMMATIC_BID_TIMEOUT=800ms

# =============================================================================
# PID Pacing Configuration
# =============================================================================
# PID controller coefficients for adaptive pacing
# Conservative defaults prevent budget burn-through on high-traffic campaigns
PID_KP=0.3   # Proportional gain (response to current error)
PID_KI=0.05  # Integral gain (response to accumulated error)
PID_KD=0.1   # Derivative gain (response to error rate change)

# =============================================================================
# Security & Tokens
# =============================================================================
# IMPORTANT: Change TOKEN_SECRET in production!
TOKEN_SECRET=changeme
TOKEN_TTL=30m

# =============================================================================
# Development & Debugging
# =============================================================================
# Enable detailed selection traces in responses (0=disabled, 1=enabled)
DEBUG_TRACE=1

# =============================================================================
# Distributed Tracing
# =============================================================================
# OpenTelemetry distributed tracing with Grafana Tempo
# Provides visibility into request flows across service boundaries
TRACING_ENABLED=true
TEMPO_ENDPOINT=tempo:4317
# Sampling rate (1.0 = 100%, 0.1 = 10%, 0.01 = 1%)
# For production, use lower values like 0.1 or 0.01 to reduce overhead
TRACING_SAMPLE_RATE=1.0

# =============================================================================
# Logging Configuration
# =============================================================================
# Environment type affects log levels and sampling rates
# Options: development, staging, production
# - development: DEBUG level, 100% log sampling (no sampling)
# - staging: INFO level, 50% log sampling
# - production: INFO level, 10% log sampling
ENV=development

# Override default log level (DEBUG, INFO, WARN, ERROR)
# If not set, defaults based on ENV: development=DEBUG, others=INFO
# LOG_LEVEL=INFO
